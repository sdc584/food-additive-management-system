# 食品添加剂管理系统 - 开发指南

## 项目概述

本系统采用前后端分离架构，包含4个独立项目：
- **user-backend**: 用户端后端 (端口8081)
- **admin-backend**: 管理端后端 (端口8082)
- **user-frontend**: 用户端前端 (端口8080)
- **admin-frontend**: 管理端前端 (端口8083)

## 后端开发指南

### 1. 项目结构

```
user-backend/admin-backend/
├── src/main/java/com/foodadditive/{user|admin}/
│   ├── entity/          # 实体类
│   ├── mapper/          # MyBatis Mapper接口
│   ├── service/         # 业务逻辑层
│   ├── controller/      # 控制器层
│   ├── config/          # 配置类
│   ├── common/          # 公共类(Result, Constants等)
│   ├── interceptor/     # 拦截器
│   └── aspect/          # 切面(日志等)
├── src/main/resources/
│   ├── mapper/          # MyBatis XML文件
│   └── application.yml  # 配置文件
└── pom.xml
```

### 2. 代码生成步骤

#### 方式一：使用MyBatis Plus代码生成器

1. 添加代码生成器依赖到pom.xml:
```xml
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-generator</artifactId>
    <version>3.5.3.1</version>
</dependency>
<dependency>
    <groupId>org.freemarker</groupId>
    <artifactId>freemarker</artifactId>
    <version>2.3.32</version>
</dependency>
```

2. 创建代码生成器类 (见附录A)

3. 运行生成器，自动生成Entity、Mapper、Service、Controller

#### 方式二：使用IDEA插件

1. 安装插件: MyBatisX 或 EasyCode
2. 连接数据库
3. 右键表名 -> 生成代码
4. 选择生成路径和模板

### 3. 需要生成的实体类 (10个)

| 序号 | 实体类 | 表名 | 说明 |
|------|--------|------|------|
| 1 | SysUser | sys_user | 用户表 |
| 2 | AdditiveCategory | additive_category | 添加剂分类表 |
| 3 | FoodAdditive | food_additive | 食品添加剂信息表 |
| 4 | Supplier | supplier | 供应商表 |
| 5 | PurchaseRecord | purchase_record | 采购记录表 |
| 6 | Inventory | inventory | 库存表 |
| 7 | UsageRecord | usage_record | 使用记录表 |
| 8 | TestReport | test_report | 检测报告表 |
| 9 | Warning | warning | 预警表 |
| 10 | OperationLog | operation_log | 操作日志表 |

### 4. 公共类开发

#### 4.1 统一返回结果类 (Result.java)

```java
package com.foodadditive.{user|admin}.common;

import lombok.Data;
import java.io.Serializable;

@Data
public class Result<T> implements Serializable {
    private Integer code;
    private String message;
    private T data;
    
    public static <T> Result<T> success(T data) {
        Result<T> result = new Result<>();
        result.setCode(200);
        result.setMessage("操作成功");
        result.setData(data);
        return result;
    }
    
    public static <T> Result<T> error(String message) {
        Result<T> result = new Result<>();
        result.setCode(500);
        result.setMessage(message);
        return result;
    }
}
```

#### 4.2 JWT工具类 (JwtUtil.java)

用于生成和验证JWT token

#### 4.3 密码加密工具类 (PasswordUtil.java)

使用BCrypt加密密码

### 5. 用户端与管理端功能差异

#### 用户端后端 (user-backend)

**开放的接口:**
- 查看添加剂信息 (只读)
- 查看库存信息 (只读)
- 提交使用记录 (新增)
- 查看检测报告 (只读)
- 查看预警信息 (只读)
- 个人信息管理

**限制:**
- 不能增删改添加剂信息
- 不能管理供应商
- 不能管理采购
- 不能查看其他用户信息
- 不能查看系统日志

#### 管理端后端 (admin-backend)

**完整权限:**
- 所有用户端功能
- 添加剂信息管理 (增删改查)
- 分类管理 (增删改查)
- 供应商管理 (增删改查)
- 采购管理 (增删改查)
- 库存管理 (增删改查)
- 检测报告管理 (增删改查)
- 用户管理 (增删改查)
- 预警处理
- 系统日志查看
- 数据统计分析
- 数据导出 (Excel)

### 6. 关键业务逻辑

#### 6.1 采购入库流程
1. 创建采购记录 (状态: PENDING)
2. 审核通过后更新库存 (状态: COMPLETED)
3. 更新库存表的 current_stock
4. 记录操作日志

#### 6.2 使用出库流程
1. 创建使用记录
2. 扣减库存
3. 检查库存是否低于最小值
4. 如果低于最小值，创建库存预警
5. 记录操作日志

#### 6.3 预警生成逻辑
- 库存预警: 当 current_stock < min_stock 时触发
- 过期预警: 当 expiry_date - 当前日期 < 30天 时触发

### 7. 接口设计规范

#### RESTful API规范

```
GET    /api/{user|admin}/additives          # 查询列表
GET    /api/{user|admin}/additives/{id}     # 查询详情
POST   /api/{user|admin}/additives          # 新增
PUT    /api/{user|admin}/additives/{id}     # 更新
DELETE /api/{user|admin}/additives/{id}     # 删除
```

#### 统一返回格式

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {}
}
```

### 8. 数据库连接配置

修改 `application.yml` 中的数据库配置:

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/food_additive_system
    username: root
    password: your_password
```

## 前端开发指南

### 1. 初始化Vue项目

#### 用户端前端

```bash
cd user-frontend
vue create .
# 选择: Vue 2.x, Router, Vuex
npm install element-ui axios --save
```

#### 管理端前端

```bash
cd admin-frontend
vue create .
# 选择: Vue 2.x, Router, Vuex
npm install element-ui axios --save
```

### 2. 项目结构

```
user-frontend/admin-frontend/
├── public/
├── src/
│   ├── api/             # API接口
│   ├── assets/          # 静态资源
│   ├── components/      # 组件
│   ├── router/          # 路由
│   ├── store/           # Vuex状态管理
│   ├── utils/           # 工具类
│   ├── views/           # 页面
│   ├── App.vue
│   └── main.js
├── package.json
└── vue.config.js
```

### 3. 需要开发的页面

#### 用户端页面
1. 登录页面
2. 首页/仪表盘
3. 添加剂信息查询
4. 库存查询
5. 使用记录提交
6. 检测报告查看
7. 预警信息查看
8. 个人中心

#### 管理端页面
1. 登录页面
2. 首页/数据统计
3. 添加剂管理
4. 分类管理
5. 供应商管理
6. 采购管理
7. 库存管理
8. 使用记录管理
9. 检测报告管理
10. 预警管理
11. 用户管理
12. 操作日志

### 4. Axios配置

创建 `src/utils/request.js`:

```javascript
import axios from 'axios'

const service = axios.create({
  baseURL: process.env.VUE_APP_BASE_API, // 用户端: http://localhost:8081/api/user
  timeout: 5000
})

// 请求拦截器
service.interceptors.request.use(
  config => {
    const token = localStorage.getItem('token')
    if (token) {
      config.headers['Authorization'] = 'Bearer ' + token
    }
    return config
  },
  error => {
    return Promise.reject(error)
  }
)

// 响应拦截器
service.interceptors.response.use(
  response => {
    const res = response.data
    if (res.code !== 200) {
      return Promise.reject(new Error(res.message || 'Error'))
    }
    return res
  },
  error => {
    return Promise.reject(error)
  }
)

export default service
```

## 附录

### 附录A: MyBatis Plus代码生成器示例

见 `docs/CodeGenerator.java`

### 附录B: 完整的Entity示例

见 `docs/EntityExample.java`

### 附录C: 完整的Controller示例

见 `docs/ControllerExample.java`

## 开发顺序建议

1. ✅ 数据库设计和创建
2. ✅ 后端项目初始化
3. 🔄 后端代码生成 (Entity, Mapper, Service, Controller)
4. 🔄 后端公共类开发 (Result, JWT, 拦截器等)
5. 🔄 后端业务逻辑开发
6. 🔄 后端接口测试
7. 🔄 前端项目初始化
8. 🔄 前端页面开发
9. 🔄 前后端联调
10. 🔄 系统测试
11. 🔄 部署
12. 🔄 编写报告

## 注意事项

1. 用户端和管理端使用相同的数据库
2. 用户端只能查询和提交使用记录，不能管理数据
3. 管理端拥有完整的管理权限
4. 所有操作都要记录到操作日志表
5. 密码必须加密存储
6. 使用JWT进行身份认证
7. 前端需要做权限控制，防止越权访问

