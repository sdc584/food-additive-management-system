# 食品添加剂管理系统 - 服务重启指南

**更新日期：** 2025-10-31  
**版本：** v1.0

---

## 🔄 为什么需要重启服务？

刚刚添加了新的后端Controller（`DashboardController.java`），需要重启后端服务才能加载新代码。

**新增功能：**
- ✅ 用户端首页统计数据从数据库真实获取
- ✅ 新增 `/api/user/dashboard/stats` 接口

---

## 📋 重启步骤

### 方法1：手动重启（推荐）

#### 第1步：停止所有服务

在各个运行窗口中按 `Ctrl + C` 停止服务：

1. **用户端后端** (端口 8081) - 按 `Ctrl + C`
2. **管理端后端** (端口 8082) - 按 `Ctrl + C`
3. **用户端前端** (端口 8080) - 按 `Ctrl + C`
4. **管理端前端** (端口 8083) - 按 `Ctrl + C`

#### 第2步：启动所有服务

**终端1 - 用户端后端 (8081):**
```bash
cd food-additive-system/user-backend
mvn spring-boot:run
```

**终端2 - 管理端后端 (8082):**
```bash
cd food-additive-system/admin-backend
mvn spring-boot:run
```

**终端3 - 用户端前端 (8080):**
```bash
cd food-additive-system/user-frontend
npm run serve
```

**终端4 - 管理端前端 (8083):**
```bash
cd food-additive-system/admin-frontend
npm run serve
```

#### 第3步：等待服务启动

- 后端服务：等待看到 "Started Application in xxx seconds"
- 前端服务：等待看到 "App running at: http://localhost:xxxx"

#### 第4步：验证服务

打开浏览器访问：
- 用户端：http://localhost:8080
- 管理端：http://localhost:8083

---

### 方法2：使用脚本重启（Windows）

创建批处理文件 `restart-all.bat`：

```batch
@echo off
echo ========================================
echo 食品添加剂管理系统 - 重启所有服务
echo ========================================
echo.

echo [1/4] 启动用户端后端 (8081)...
start "用户端后端" cmd /k "cd food-additive-system\user-backend && mvn spring-boot:run"
timeout /t 5

echo [2/4] 启动管理端后端 (8082)...
start "管理端后端" cmd /k "cd food-additive-system\admin-backend && mvn spring-boot:run"
timeout /t 5

echo [3/4] 启动用户端前端 (8080)...
start "用户端前端" cmd /k "cd food-additive-system\user-frontend && npm run serve"
timeout /t 5

echo [4/4] 启动管理端前端 (8083)...
start "管理端前端" cmd /k "cd food-additive-system\admin-frontend && npm run serve"

echo.
echo ========================================
echo 所有服务启动命令已执行！
echo 请等待各服务启动完成...
echo ========================================
pause
```

---

## ✅ 验证新功能

### 1. 测试统计API

重启后端后，测试新的统计接口：

```bash
curl http://localhost:8081/api/user/dashboard/stats
```

**预期响应：**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "additiveCount": 7,
    "inventoryTotal": 1234.5,
    "warningCount": 3,
    "usageCount": 5
  }
}
```

### 2. 测试前端页面

1. 打开浏览器访问：http://localhost:8080
2. 登录系统（admin / 123456）
3. 查看首页统计数据
4. 打开浏览器开发者工具（F12）
5. 切换到 Network 标签
6. 刷新页面
7. 查看 `dashboard/stats` 请求
8. 确认返回的是真实数据

### 3. 验证数据真实性

**方法1：查看数据库**
```sql
-- 连接数据库
mysql -u root -psdc1534260.0

-- 使用数据库
USE food_additive_system;

-- 查看添加剂数量
SELECT COUNT(*) as additive_count FROM food_additive;

-- 查看库存总量
SELECT SUM(quantity) as inventory_total FROM inventory;

-- 查看预警数量
SELECT COUNT(*) as warning_count FROM warning;

-- 查看本月使用记录数量
SELECT COUNT(*) as usage_count 
FROM usage_record 
WHERE usage_date >= DATE_FORMAT(NOW(), '%Y-%m-01');
```

**方法2：对比数据**
- 数据库查询结果 = 首页显示数据 ✅

---

## 🔍 常见问题

### Q1: 端口被占用怎么办？

**Windows:**
```bash
# 查看端口占用
netstat -ano | findstr :8081
netstat -ano | findstr :8082
netstat -ano | findstr :8080
netstat -ano | findstr :8083

# 杀死进程（替换 PID 为实际进程ID）
taskkill /F /PID <PID>
```

### Q2: Maven编译失败怎么办？

```bash
# 清理并重新编译
cd food-additive-system/user-backend
mvn clean install

cd food-additive-system/admin-backend
mvn clean install
```

### Q3: npm启动失败怎么办？

```bash
# 重新安装依赖
cd food-additive-system/user-frontend
rm -rf node_modules package-lock.json
npm install

cd food-additive-system/admin-frontend
rm -rf node_modules package-lock.json
npm install
```

### Q4: 数据库连接失败怎么办？

检查配置文件：
- `user-backend/src/main/resources/application.yml`
- `admin-backend/src/main/resources/application.yml`

确认：
- MySQL服务已启动
- 数据库名称：food_additive_system
- 用户名：root
- 密码：sdc1534260.0

---

## 📊 服务状态检查

### 检查后端服务

```bash
# 用户端后端
curl http://localhost:8081/api/user/dashboard/stats

# 管理端后端
curl http://localhost:8082/api/admin/foodAdditives
```

### 检查前端服务

浏览器访问：
- http://localhost:8080 - 用户端
- http://localhost:8083 - 管理端

---

## 🎯 重启后的测试清单

- [ ] 用户端后端启动成功（8081）
- [ ] 管理端后端启动成功（8082）
- [ ] 用户端前端启动成功（8080）
- [ ] 管理端前端启动成功（8083）
- [ ] 统计API返回真实数据
- [ ] 首页显示真实统计数据
- [ ] 数据库数据与页面显示一致
- [ ] 无控制台错误
- [ ] 所有功能正常

---

## 📝 本次更新内容

### 后端新增
- ✅ `DashboardController.java` - 统计数据控制器
- ✅ `InventoryService.getTotalQuantity()` - 获取库存总量
- ✅ `UsageRecordService.getCurrentMonthCount()` - 获取当月使用记录数

### 前端新增
- ✅ `dashboard.js` - 统计数据API模块
- ✅ `Home.vue` - 修改为使用真实数据

### 数据变化
- ❌ 移除硬编码模拟数据
- ✅ 使用数据库真实数据

---

## 🚀 快速重启命令

如果你已经熟悉流程，可以直接使用以下命令：

```bash
# 终端1
cd food-additive-system/user-backend && mvn spring-boot:run

# 终端2
cd food-additive-system/admin-backend && mvn spring-boot:run

# 终端3
cd food-additive-system/user-frontend && npm run serve

# 终端4
cd food-additive-system/admin-frontend && npm run serve
```

---

**文档编写：** 系统开发团队  
**最后更新：** 2025-10-31  
**版本：** v1.0

