# 食品添加剂管理系统 - 启动指南

## 📋 前置要求

### 必需软件
1. **JDK 1.8+** - Java开发环境
2. **Maven 3.6+** - Java项目构建工具
3. **MySQL 8.0** - 数据库
4. **Node.js 14+** - 前端开发环境
5. **npm 或 yarn** - 前端包管理器

### 可选软件
1. **IntelliJ IDEA** - Java开发IDE（推荐）
2. **VSCode** - 前端开发IDE（推荐）
3. **Navicat** - 数据库管理工具

## 🚀 快速启动（5分钟）

### 第一步：初始化数据库

```bash
# 1. 启动MySQL服务
# Windows: 在服务中启动MySQL
# Linux/Mac: sudo service mysql start

# 2. 登录MySQL
mysql -u root -p

# 3. 创建数据库
CREATE DATABASE food_additive_system DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# 4. 退出MySQL
exit

# 5. 导入数据库脚本
cd food-additive-system
mysql -u root -p food_additive_system < database/schema.sql
```

### 第二步：配置数据库连接

修改两个后端项目的配置文件，将数据库密码改为你的MySQL密码：

**文件1：** `user-backend/src/main/resources/application.yml`
**文件2：** `admin-backend/src/main/resources/application.yml`

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/food_additive_system?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
    username: root
    password: 你的MySQL密码  # 修改这里
```

### 第三步：启动后端服务

#### 方式一：使用IDEA（推荐）

1. 用IDEA打开 `food-additive-system` 文件夹
2. 等待Maven依赖下载完成（首次需要5-10分钟）
3. 找到 `user-backend/src/main/java/com/foodadditive/user/UserBackendApplication.java`
4. 右键 → Run 'UserBackendApplication'
5. 等待启动成功，看到 "用户端后端启动成功！"
6. 重复3-5步，启动 `AdminBackendApplication.java`

#### 方式二：使用命令行

```bash
# 启动用户端后端（新开一个终端）
cd user-backend
mvn spring-boot:run

# 启动管理端后端（新开另一个终端）
cd admin-backend
mvn spring-boot:run
```

### 第四步：验证后端启动

打开浏览器访问：

- 用户端后端：http://localhost:8081/api/user
- 管理端后端：http://localhost:8082/api/admin
- Druid监控：http://localhost:8081/api/user/druid （用户名/密码：admin/admin）

如果看到页面或JSON响应，说明启动成功！

### 第五步：测试登录接口

使用Postman或curl测试登录：

```bash
# 测试用户端登录
curl -X POST http://localhost:8081/api/user/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"user1","password":"123456"}'

# 测试管理端登录
curl -X POST http://localhost:8082/api/admin/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"123456"}'
```

如果返回包含token的JSON，说明后端工作正常！

## 🎨 前端开发（可选）

### 初始化前端项目

```bash
# 运行前端初始化脚本
bash init-frontend.sh

# 选择 3 (全部初始化)
```

### 启动前端服务

```bash
# 启动用户端前端（新开一个终端）
cd user-frontend
npm run serve

# 启动管理端前端（新开另一个终端）
cd admin-frontend
npm run serve
```

### 访问前端

- 用户端前端：http://localhost:8080
- 管理端前端：http://localhost:8083

## 📝 默认账号

### 管理员账号
- 用户名：`admin`
- 密码：`123456`
- 角色：ADMIN

### 普通用户账号
- 用户名：`user1` 或 `user2`
- 密码：`123456`
- 角色：USER

## ❓ 常见问题

### 1. Maven依赖下载失败

**问题：** 依赖下载很慢或失败

**解决：** 配置Maven阿里云镜像

编辑 `~/.m2/settings.xml`（如果没有就创建）：

```xml
<settings>
  <mirrors>
    <mirror>
      <id>aliyun</id>
      <mirrorOf>central</mirrorOf>
      <name>Aliyun Maven</name>
      <url>https://maven.aliyun.com/repository/public</url>
    </mirror>
  </mirrors>
</settings>
```

### 2. 端口被占用

**问题：** 启动时提示端口已被占用

**解决：** 修改端口或关闭占用端口的程序

修改 `application.yml` 中的端口：

```yaml
server:
  port: 8081  # 改为其他端口，如8091
```

### 3. 数据库连接失败

**问题：** 启动时提示数据库连接失败

**解决：**
1. 检查MySQL服务是否启动
2. 检查数据库名称是否正确
3. 检查用户名密码是否正确
4. 检查MySQL是否允许本地连接

### 4. 找不到Entity类

**问题：** 编译时提示找不到Entity类

**解决：** 运行Entity生成脚本

```bash
python3 generate-entities.py
# 选择 3 (全部生成)
```

### 5. BCrypt相关错误

**问题：** 启动时提示BCrypt相关错误

**解决：** 在pom.xml中添加Spring Security依赖：

```xml
<dependency>
    <groupId>org.springframework.security</groupId>
    <artifactId>spring-security-crypto</artifactId>
</dependency>
```

### 6. 前端npm install失败

**问题：** npm install下载依赖失败

**解决：** 配置npm淘宝镜像

```bash
npm config set registry https://registry.npmmirror.com
```

## 🔧 开发工具推荐

### IDEA插件
1. **Lombok** - 简化Java代码
2. **MyBatisX** - MyBatis增强工具
3. **RestfulTool** - 接口测试工具

### VSCode插件
1. **Vetur** - Vue开发工具
2. **ESLint** - 代码检查
3. **Prettier** - 代码格式化

### 接口测试工具
1. **Postman** - 接口测试（推荐）
2. **Apifox** - 国产接口测试工具
3. **curl** - 命令行工具

## 📊 项目状态检查

### 检查后端是否正常

```bash
# 检查用户端后端
curl http://localhost:8081/api/user/auth/info

# 检查管理端后端
curl http://localhost:8082/api/admin/auth/info
```

### 检查数据库是否正常

```bash
mysql -u root -p -e "USE food_additive_system; SHOW TABLES;"
```

应该看到10个表：
- sys_user
- additive_category
- food_additive
- supplier
- purchase_record
- inventory
- usage_record
- test_report
- warning
- operation_log

## 🎯 下一步

1. ✅ 后端已启动 → 开始开发前端页面
2. ✅ 前端已初始化 → 开发登录页面
3. ✅ 登录功能完成 → 开发业务功能页面
4. ✅ 所有功能完成 → 进行系统测试
5. ✅ 测试通过 → 编写实验报告

## 📞 获取帮助

如果遇到其他问题：

1. 查看控制台日志
2. 查看 `docs/开发指南.md`
3. 查看 `项目完成情况.md`
4. 检查数据库连接
5. 检查端口占用情况

## 🎉 成功标志

当你看到以下内容时，说明系统启动成功：

✅ 用户端后端：http://localhost:8081/api/user 可访问
✅ 管理端后端：http://localhost:8082/api/admin 可访问
✅ 登录接口返回token
✅ 数据库有10个表和初始数据
✅ Druid监控页面可访问

恭喜！你已经成功启动了食品添加剂管理系统！🚀

