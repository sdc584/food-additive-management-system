# 数据库脚本修复说明

## 修复日期
2025-10-31

## 修复内容

### 1. 供应商表 (supplier) 数据修复

#### 修复前（旧数据）：
```sql
INSERT INTO supplier (supplier_name, supplier_code, contact_person, contact_phone, contact_email, address, credit_level, business_license, status) VALUES
('上海添加剂公司', 'SUP001', '王经理', '021-12345678', 'wang@sh-additive.com', '上海市浦东新区', 'AAA', '91310000MA1FL5E73X', 1),
('北京食品原料', 'SUP002', '李经理', '010-87654321', 'li@bj-food.com', '北京市朝阳区', 'AA', '91110000MA1FL5E74Y', 1),
('广州化工贸易', 'SUP003', '张经理', '020-98765432', 'zhang@gz-chem.com', '广州市天河区', 'AAA', '91440000MA1FL5E75Z', 1);
```

#### 修复后（新数据）：
```sql
INSERT INTO supplier (supplier_name, supplier_code, contact_person, contact_phone, contact_email, address, credit_level, business_license, status, remark) VALUES
('上海添加剂供应有限公司', 'SUP001', '张经理', '021-12345678', 'zhang@supplier1.com', '上海市浦东新区张江高科技园区', 'AAA', '91310000MA1K12345A', 1, '主要供应食品级柠檬酸、山梨酸钾等'),
('维他命供应商(北京)有限公司', 'SUP002', '李经理', '010-87654321', 'li@supplier2.com', '北京市朝阳区CBD中心', 'AA', '91110000MA1K67890B', 1, '专业维生素类添加剂供应商'),
('粤港食品添加剂贸易公司', 'SUP003', '黄经理', '020-98765432', 'huang@supplier3.com', '广州市天河区珠江新城', 'AAA', '91440000MA1K11111C', 1, '华南地区最大的食品添加剂供应商');
```

#### 主要变化：
1. **添加了 `remark` 字段** - 增加供应商备注信息
2. **更新了供应商名称** - 使用更完整的公司名称
3. **更新了联系人** - ID=1 从"王经理"改为"张经理"，ID=3 从"张经理"改为"黄经理"
4. **更新了邮箱地址** - 使用更规范的邮箱格式
5. **更新了详细地址** - 提供更具体的地址信息
6. **更新了营业执照号** - 使用实际的营业执照编号格式

### 2. 库存表 (inventory) 数据修复

#### 修复前：
```sql
(1, 80.00, 20.00, 200.00, 'A区-01货架', '2024-01-15', '2024-03-10', 1),
```

#### 修复后：
```sql
(1, 81.00, 20.00, 200.00, 'A区-01货架', '2024-01-15', '2024-03-10', 1),
```

#### 主要变化：
- **更新了库存数量** - ID=1 的库存从 80.00 改为 81.00（反映实际库存变化）

### 3. 脚本头部注释优化

#### 修复前：
```sql
-- ============================================
-- 食品添加剂管理系统 - 完整数据库脚本
-- 包含表结构创建和初始数据导入
-- 所有表都有外键关联，无孤表
-- ============================================
```

#### 修复后：
```sql
-- ============================================
-- 食品添加剂管理系统 - 完整数据库脚本
-- 包含表结构创建和初始数据导入
-- 所有表都有外键关联，无孤表
-- ============================================
-- 注意：此脚本会删除并重新创建数据库，请谨慎使用！
-- 使用方法：mysql -u root -p --default-character-set=utf8mb4 < complete-schema.sql
-- ============================================
```

#### 主要变化：
- **添加了警告信息** - 提醒用户脚本会删除数据库
- **添加了使用说明** - 提供正确的执行命令

## 验证结果

### 执行测试
```bash
mysql -u root -p --default-character-set=utf8mb4 < database/complete-schema.sql
```

### 验证数据
所有表的数据已验证正确，包括：
- ✅ 用户表 (sys_user) - 3条记录
- ✅ 分类表 (additive_category) - 6条记录
- ✅ 添加剂表 (food_additive) - 7条记录
- ✅ 供应商表 (supplier) - 3条记录（已更新）
- ✅ 采购记录表 (purchase_record) - 5条记录
- ✅ 库存表 (inventory) - 7条记录（已更新）
- ✅ 使用记录表 (usage_record) - 5条记录
- ✅ 检测报告表 (test_report) - 3条记录
- ✅ 预警表 (warning) - 2条记录
- ✅ 操作日志表 (operation_log) - 4条记录

### 中文显示验证
所有中文数据显示正常，无乱码：
- ✅ 供应商名称：上海添加剂供应有限公司、维他命供应商(北京)有限公司、粤港食品添加剂贸易公司
- ✅ 联系人：张经理、李经理、黄经理
- ✅ 添加剂名称：山梨酸钾、苯甲酸钠、维生素E等
- ✅ 分类名称：防腐剂、抗氧化剂、着色剂等
- ✅ 仓库位置：A区-01货架、B区-02货架等

## 使用建议

1. **首次安装**：直接执行 `complete-schema.sql` 即可创建完整的数据库
2. **重新初始化**：如需重置数据库，执行此脚本会删除旧数据并创建新数据
3. **字符集**：务必使用 `--default-character-set=utf8mb4` 参数以确保中文正常显示
4. **备份**：执行前请备份现有数据库

## 相关文件

- `complete-schema.sql` - 完整的数据库初始化脚本（已修复）
- `fix-all-chinese-data.sql` - 中文乱码修复脚本（用于修复已存在的数据库）
- `fix-supplier-data.sql` - 供应商数据修复脚本

## 修复人员
AI Assistant

## 审核状态
✅ 已测试通过

