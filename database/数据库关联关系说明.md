# 食品添加剂管理系统 - 数据库关联关系说明

## ✅ 数据库创建成功

- **数据库名称：** food_additive_system
- **字符集：** utf8mb4
- **排序规则：** utf8mb4_unicode_ci
- **表数量：** 10个
- **外键数量：** 12个
- **所有表都有关联，无孤表** ✅

## 📊 数据统计

| 表名 | 记录数 | 说明 |
|------|--------|------|
| sys_user (用户表) | 3 | 1个管理员 + 2个普通用户 |
| additive_category (分类表) | 6 | 6个添加剂分类 |
| food_additive (添加剂表) | 7 | 7种食品添加剂 |
| supplier (供应商表) | 3 | 3个供应商 |
| purchase_record (采购记录表) | 5 | 5条采购记录 |
| inventory (库存表) | 7 | 7条库存记录 |
| usage_record (使用记录表) | 5 | 5条使用记录 |
| test_report (检测报告表) | 3 | 3份检测报告 |
| warning (预警表) | 2 | 2条预警信息 |
| operation_log (操作日志表) | 4 | 4条操作日志 |

## 🔗 表关联关系图

```
┌─────────────────────────────────────────────────────────────────┐
│                     食品添加剂管理系统表关联图                    │
└─────────────────────────────────────────────────────────────────┘

                    ┌──────────────┐
                    │  sys_user    │ (用户表)
                    │  user_id(PK) │
                    └──────┬───────┘
                           │
           ┌───────────────┼───────────────┬──────────────┐
           │               │               │              │
           ▼               ▼               ▼              ▼
    ┌──────────┐   ┌──────────────┐  ┌──────────┐  ┌──────────┐
    │operation │   │purchase_record│  │usage_    │  │warning   │
    │_log      │   │purchaser_id   │  │record    │  │handler_id│
    │user_id   │   │(FK)           │  │user_id   │  │(FK)      │
    └──────────┘   └───────┬───────┘  └────┬─────┘  └────┬─────┘
                           │               │             │
                           │               │             │
    ┌──────────────────────┼───────────────┼─────────────┘
    │                      │               │
    │                      ▼               │
    │              ┌──────────────┐        │
    │              │food_additive │        │
    │              │additive_id   │        │
    │              │(PK)          │        │
    │              │category_id   │        │
    │              │(FK)          │        │
    │              └──────┬───────┘        │
    │                     │                │
    │                     │                │
    │      ┌──────────────┼────────────────┼──────────┐
    │      │              │                │          │
    │      ▼              ▼                ▼          ▼
    │  ┌────────┐   ┌──────────┐    ┌──────────┐ ┌──────────┐
    │  │test_   │   │inventory │    │purchase_ │ │usage_    │
    │  │report  │   │additive_ │    │record    │ │record    │
    │  │additive│   │id(FK)    │    │additive_ │ │additive_ │
    │  │_id(FK) │   └────┬─────┘    │id(FK)    │ │id(FK)    │
    │  └────────┘        │          └────┬─────┘ └──────────┘
    │                    │               │
    │                    │               │
    │                    ▼               ▼
    │              ┌──────────┐    ┌──────────┐
    │              │warning   │    │supplier  │
    │              │inventory │    │supplier_ │
    │              │_id(FK)   │    │id(PK)    │
    │              │additive_ │    └────┬─────┘
    │              │id(FK)    │         │
    │              └──────────┘         │
    │                                   │
    │                                   ▼
    │                            ┌──────────────┐
    │                            │purchase_     │
    │                            │record        │
    │                            │supplier_id   │
    │                            │(FK)          │
    │                            └──────────────┘
    │
    ▼
┌──────────────────┐
│additive_category │
│category_id(PK)   │
│parent_id(自关联) │
└──────────────────┘
```

## 📋 详细外键关系

### 1. sys_user (用户表) - 核心表
**被引用次数：4次**

| 引用表 | 外键列 | 说明 |
|--------|--------|------|
| operation_log | user_id | 记录用户操作日志 |
| purchase_record | purchaser_id | 记录采购员信息 |
| usage_record | user_id | 记录使用操作员 |
| warning | handler_id | 记录预警处理人 |

### 2. additive_category (分类表)
**被引用次数：1次**

| 引用表 | 外键列 | 说明 |
|--------|--------|------|
| food_additive | category_id | 添加剂所属分类 |

**自关联：** parent_id → category_id (支持多级分类)

### 3. food_additive (添加剂信息表) - 核心表
**被引用次数：6次**

| 引用表 | 外键列 | 说明 |
|--------|--------|------|
| inventory | additive_id | 库存对应的添加剂 |
| purchase_record | additive_id | 采购的添加剂 |
| usage_record | additive_id | 使用的添加剂 |
| test_report | additive_id | 检测的添加剂 |
| warning | additive_id | 预警的添加剂 |

**引用表：**
| 被引用表 | 外键列 | 说明 |
|----------|--------|------|
| additive_category | category_id | 所属分类 |

### 4. supplier (供应商表)
**被引用次数：1次**

| 引用表 | 外键列 | 说明 |
|--------|--------|------|
| purchase_record | supplier_id | 采购的供应商 |

### 5. inventory (库存表)
**被引用次数：1次**

| 引用表 | 外键列 | 说明 |
|--------|--------|------|
| warning | inventory_id | 库存预警 |

**引用表：**
| 被引用表 | 外键列 | 说明 |
|----------|--------|------|
| food_additive | additive_id | 库存对应的添加剂 |

### 6. purchase_record (采购记录表)
**引用表：3个**

| 被引用表 | 外键列 | 说明 |
|----------|--------|------|
| food_additive | additive_id | 采购的添加剂 |
| supplier | supplier_id | 供应商 |
| sys_user | purchaser_id | 采购员 |

### 7. usage_record (使用记录表)
**引用表：2个**

| 被引用表 | 外键列 | 说明 |
|----------|--------|------|
| food_additive | additive_id | 使用的添加剂 |
| sys_user | user_id | 操作员 |

### 8. test_report (检测报告表)
**引用表：1个**

| 被引用表 | 外键列 | 说明 |
|----------|--------|------|
| food_additive | additive_id | 检测的添加剂 |

### 9. warning (预警表)
**引用表：3个**

| 被引用表 | 外键列 | 说明 |
|----------|--------|------|
| food_additive | additive_id | 预警的添加剂 |
| inventory | inventory_id | 预警的库存 |
| sys_user | handler_id | 处理人 |

### 10. operation_log (操作日志表)
**引用表：1个**

| 被引用表 | 外键列 | 说明 |
|----------|--------|------|
| sys_user | user_id | 操作用户 |

## ✅ 满足课程要求验证

### 要求1：模块数量超过8个
- ✅ **实际：10个模块**
- 用户管理、分类管理、添加剂管理、供应商管理、采购管理、库存管理、使用记录管理、检测报告管理、预警管理、操作日志

### 要求2：所有表必须与另一个表有关联，不允许孤表
- ✅ **所有10个表都有外键关联**
- 总共12个外键约束
- 每个表至少有1个外键关联（引用或被引用）

## 🔍 表关联验证

### 无孤表验证
```sql
-- 所有表都有外键关联
1. sys_user: 被4个表引用 (operation_log, purchase_record, usage_record, warning)
2. additive_category: 被1个表引用 (food_additive), 自关联 (parent_id)
3. food_additive: 引用1个表 (additive_category), 被5个表引用
4. supplier: 被1个表引用 (purchase_record)
5. inventory: 引用1个表 (food_additive), 被1个表引用 (warning)
6. purchase_record: 引用3个表 (food_additive, supplier, sys_user)
7. usage_record: 引用2个表 (food_additive, sys_user)
8. test_report: 引用1个表 (food_additive)
9. warning: 引用3个表 (food_additive, inventory, sys_user)
10. operation_log: 引用1个表 (sys_user)
```

**结论：✅ 所有表都有关联，无孤表！**

## 📝 默认账号信息

| 用户名 | 密码 | 角色 | 姓名 |
|--------|------|------|------|
| admin | 123456 | ADMIN | 管理员 |
| user1 | 123456 | USER | 张三 |
| user2 | 123456 | USER | 李四 |

**注意：** 密码已使用BCrypt加密存储

## 🎯 数据库特点

1. **完整的外键约束** - 保证数据完整性
2. **级联操作** - 自动维护关联数据
3. **索引优化** - 提高查询性能
4. **时间戳自动更新** - create_time, update_time
5. **软删除支持** - status字段
6. **丰富的初始数据** - 便于测试

## 🚀 下一步

数据库已经完全准备好，可以：
1. ✅ 启动后端服务
2. ✅ 测试API接口
3. ⚠️ 开发前端页面
4. ⚠️ 系统测试
5. ⚠️ 编写报告

---

**数据库创建时间：** 2025-01-01  
**脚本文件：** database/complete-schema.sql  
**状态：** ✅ 已完成并验证

